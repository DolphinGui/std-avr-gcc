name: Build toolchain for linux
on:
  workflow_dispatch:
  push:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Install crosstool-NG dependencies
      run: |
        sudo apt-get update
        sudo apt-get install gcc g++ gperf bison flex texinfo help2man make libncurses5-dev \
        python3-dev autoconf automake libtool libtool-bin gawk wget bzip2 xz-utils unzip \
        patch libstdc++6 rsync git meson ninja-build
    - name: Get crosstool-NG
      run: ./.github/scripts/ct-ng.sh
    - name: Append ct-ng to path
      run: echo `realpath ./ctroot` >> "$GITHUB_PATH"
    - name: Test path
      run: echo "$PATH"
    - name: Build linux
      run: ./.github/scripts/build-linux.sh
    - name: Upload archive
      uses: actions/upload-artifact@v4
      with:
        name: root.tar
        path: linux-build/root